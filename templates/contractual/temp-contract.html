{% extends current_module.base_template %}
{% load i18n material_form material_frontend %}
{% load humanize %}
{% load static %}

{% block breadcrumbs_items %}
{% endblock %}


{% block footer %}
<script type="text/javascript">
$(document).ready(function(){
    $('.modal').modal({
        dismissible: true, // Modal can be dismissed by clicking outside of the modal
        opacity: .5, // Opacity of modal background
        inDuration: 300, // Transition in duration
        outDuration: 200, // Transition out duration
        startingTop: '4%', // Starting top style attribute
        endingTop: '10%', // Ending top style attribute
        ready: function(modal, trigger) { // Callback for Modal open. Modal and trigger parameters available.
            //alert("Ready");
            console.log(modal, trigger);
        },
        complete: function(obj) {
            //alert('Closed');
        } // Callback for Modal close
    });
    $('ul.tabs').tabs({
        onShow: function() {
            //alert(1);
        }
    });
});

function save_contractor(obj) {
    form_obj = $("#new_contractor_form")
    form_obj.submit(function(){
        eb.ajax_request(
            $(this).attr('action'),
            $(this).attr('method'),
            $(this).serialize(),
            function mail_callback_fn(data) {
                window.location = "{% url 'contractual:create_temp_contract' %}?parking_position_id={{ parkingposition.pk }}";
                $('#start_contract').modal('close');
            },
            function failure(result) {
                eb.reflection_form_errors(form_obj, result.responseJSON);
            },
            function always(result) {}
        );
        return false;
    });
    form_obj.submit();
}
</script>
{% endblock %}

{% block content %}
{% get_media_prefix as MEDIA_PREFIX %}
<div class="left-panel" style="flex-basis: 100%;">
    <div class="card">
        <div class="card-content">
            <div class="card-title">
                {{ parkingposition.parking_lot }} － 車室 {{ parkingposition.name }}
                {% if parkingposition.contracts.count %}
                {% elif parkingposition.temp_contracts.count %}
                    <span class="new badge left deep-orange" data-badge-caption="手続中" style="margin-left: 0px;"></span>
                {% else %}
                    <span class="new badge left green" data-badge-caption="空き" style="margin-left: 0px;"></span>
                {% endif %}
            </div>
            <table class="table bordered">
                <tbody>
                <tr>
                    <th>募集賃料（税込）：</th>
                    <td>{{ parkingposition.price_recruitment|default:''|intcomma }}</td>
                    <th>募集賃料（税抜）：</th>
                    <td>{{ parkingposition.price_recruitment_no_tax|default:''|intcomma }}</td>
                    <th>ホームページ（税込）：</th>
                    <td>{{ parkingposition.price_homepage|default:''|intcomma }}</td>
                    <th>ホームページ（税別）：</th>
                    <td>{{ parkingposition.price_homepage_no_tax|default:''|intcomma }}</td>
                </tr>
                <tr>
                    <th>チラシ価格（税込）：</th>
                    <td>{{ parkingposition.price_handbill|default:''|intcomma }}</td>
                    <th>チラシ価格（税抜）：</th>
                    <td>{{ parkingposition.price_handbill_no_tax|default:''|intcomma }}</td>
                    <th></th>
                    <td></td>
                    <th></th>
                    <td></td>
                </tr>
                <tr>
                    <th>全長：</th>
                    <td>{{ parkingposition.length|default:''|intcomma }}</td>
                    <th>全幅：</th>
                    <td>{{ parkingposition.width|default:''|intcomma }}</td>
                    <th>全高：</th>
                    <td>{{ parkingposition.height|default:''|intcomma }}</td>
                    <th>重量：</th>
                    <td>{{ parkingposition.weight|default:''|intcomma }}</td>
                </tr>
                <tr>
                    <th>ﾒｰｶｰのタイヤ幅：</th>
                    <td>{{ parkingposition.tyre_width|default:''|intcomma }}</td>
                    <th>AP計測のタイヤ幅：</th>
                    <td>{{ parkingposition.tyre_width_ap|default:''|intcomma }}</td>
                    <th>ﾒｰｶｰの地上最低高：</th>
                    <td>{{ parkingposition.min_height|default:''|intcomma }}</td>
                    <th>AP計測の地上最低高：</th>
                    <td>{{ parkingposition.min_height_ap|default:''|intcomma }}</td>
                </tr>
                <tr>
                    <th>F値：</th>
                    <td>{{ parkingposition.f_value|default:''|intcomma }}</td>
                    <th>R値：</th>
                    <td>{{ parkingposition.r_value|default:''|intcomma }}</td>
                    <th>時間制限：</th>
                    <td>{{ parkingposition.time_limit }}</td>
                    <th></th>
                    <td></td>
                </tr>
                <tr>
                    <th>備考：</th>
                    <td colspan="7"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="card">
        <div class="card-content">
            <div class="card-title">{{ parkingposition.parking_lot }} － 基本情報</div>
            <table class="table bordered">
                <tbody>
                <tr>
                    <th>物件番号：</th>
                    <td>{{ parkingposition.parking_lot.code }}</td>
                    <th>名称：</th>
                    <td>{{ parkingposition.parking_lot.name|default:'' }}</td>
                </tr>
                <tr>
                    <th>駐車場分類：</th>
                    <td>{{ parkingposition.parking_lot.segment|default:'' }}</td>
                    <th>郵便番号：</th>
                    <td>{{ parkingposition.parking_lot.post_code|default:'' }}</td>
                </tr>
                <tr>
                    <th>住所：</th>
                    <td colspan="3">{{ parkingposition.parking_lot.address|default:'' }}</td>
                </tr>
                <tr>
                    <th>交通：</th>
                    <td colspan="3">{{ parkingposition.parking_lot.traffic|default:'' }}</td>
                </tr>
                <tr>
                    <th>備考：</th>
                    <td colspan="3">{{ parkingposition.parking_lot.comment|default:'' }}</td>
                </tr>
                </tbody>
            </table>
            <div class="card-action">
                <div class="right-align">
                    <a class="waves-effect waves-light btn modal-trigger" href="#nearest_parking_lot">近くの空き物件</a>
                </div>
            </div>
            <div id="nearest_parking_lot" class="modal bottom-sheet">
                <div class="modal-content">
                    <h4>近くの空き物件</h4>
                    <div class="card-content">
                        <table id="table" class="table bordered" data-form-control="datatable" style="width:100%">
                            <thead>
                            <tr>
                                <th>物件番号</th>
                                <th>駐車場名</th>
                                <th>住所</th>
                                <th>距離</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>0001</td>
                                <td><a href="javascript:void(0)">パシフィックレジデンス目黒本町</a></td>
                                <td>東京都目黒区目黒本町2-23-6</td>
                                <td>100メートル</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                  <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Close</a>
                </div>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="card-content">
            <div class="card-title">書類一式</div>
            <table class="table bordered">
                <tbody>
                {% for doc in parkingposition.parking_lot.parkinglotdoc_set.all %}
                    <tr>
                        <td><a href="{{ MEDIA_PREFIX }}{{ doc.document }}">{{ doc.document }}</a></td>
                        <td>{{ doc.comment|default:'' }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="card">
        <div class="card-content">
            <div class="card-title">駐車場画像一覧</div>
            <table class="table bordered">
                <tbody>
                    <tr>
                    {% for img in parkingposition.parking_lot.parkinglotimage_set.all %}
                         <td>
                             <a href="{{ MEDIA_PREFIX }}{{ img.image }}">
                                <img src="{{ MEDIA_PREFIX }}{{ img.image }}" width="120px"/>
                             </a>
                         </td>
                    {% endfor %}
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% block right-panel %}
{% endblock right-panel %}
{% block action_btn %}
<div class="fixed-action-btn">
    {% if add_url %}
      <a class="btn-floating btn-large waves-effect waves-light red z-depth-2" href="{{ add_url }}"><i class="large material-icons">add</i></a>
    {% endif %}
</div>
{% endblock %}
{% endblock %}
